<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Car Clicker</title>

    <style>
      .sectionLeft{
        float: left;
        width: 80%;
      }

      .sectionRight{
        float: right;
        width: 20%;
      }

      .carContainer{
        background-color: rgb(238, 238, 238);
        width: 50%;
        padding: 10px;
        border-radius: 10px;
        font-size: 24px;
        font-weight: bold;
      }

      .clickerContainer img{
        position: relative;
        transition: all .2s ease-in-out;
      }

      .shopButton{
        background-color: #b5b5b5;
        transition: all .2s ease-in-out;
        border-radius: 10px;
        width: 100%;
        margin: 10px 0px 10px 0px;
      }

      .shopButton:hover{
        background-color: #c7c7c7;
        transition: all .2s ease-in-out;
      }

      .shopButton #image{
        width: 25%;
      }

      .shopButton img{
        height: 64px;
        width: 64px;
      }

      .shopButton #nameAndCost p{
        margin: 0px;
        width: 60%;
      }

      .shopButton #nameAndCost p:first-of-type{
        font-size: 24px;
      }

      .shopButton #amount{
        font-size: 48px;
        color: #595959;
        font-family: roboto;
        width: 15%;
      }

      .sectionFooter{
        margin-top: 20%;
      }

      .unselectable{
        user-select: none;
      }

      .clickerContainer img:hover{transform: scale(1.10);}
      .clickerContainer img:active{transform: scale(0.99);}
    </style>
  </head>
  <body>
    <div class="sectionLeft">
      <center>
        <div class="carContainer unselectable">
          <span id="cars">0</span> cars<br>
          <span id="carsPerSecond">0</span> Cars Per Second
        </div>
          <br>
          <div class="clickerContainer unselectable">
            <img src="car.png" height="256px" width="256px" onclick="game.addToCars(game.clickValue)">
          </div>
      </center>
      <div class="sectionFooter">
        <h5>Car Clicker</h5>
        <button onclick="reset();">Reset</button>
      </div>
    </div>

    <div class="sectionRight" id="shopContainer">
    </div>

    <script>
      var game = {
        cars: 0,
        totalCars: 0,
        totalClicks: 0,
        clickValue: 1,
        version: 0.000,

        addToCars: function(amount){
          this.cars += amount;
          this.totalCars += amount;
          display.updateCars();
        },

        getCarsPerSecond: function(){
          var carsPerSecond = 0;
          for(i = 0; i < building.name.length; i++){
            carsPerSecond += building.income[i] * building.count[i];
          }
          return carsPerSecond;
        }
      };

      var building = {
          name: [
            "Common",
            "Luxury",
            "Super"
          ],
          image: [
            "common.png",
            "luxury.png",
            "supercar.png"
          ],
          count: [0,0,0],
          income: [1,15,155],
          cost: [100,1000,10000],

          purchase: function(index){
            if(game.cars >= this.cost[index]){
              game.cars -= this.cost[index];
              this.count[index]++;
              this.cost[index] = Math.ceil(this.cost[index] * 1.10);
              display.updateCars();
              display.updateShop();
            }
          }
      };

      var display = {
        updateCars: function(){
          document.getElementById("cars").innerHTML = game.cars;
          document.getElementById("carsPerSecond").innerHTML = game.getCarsPerSecond();
          document.title = game.cars + " Cars | Car Clicker";
        },

        updateShop: function(){
          document.getElementById("shopContainer").innerHTML = "";
          for(i = 0; i < building.name.length; i++){
            document.getElementById("shopContainer").innerHTML += '<table class="shopButton unselectable" onclick="building.purchase('+i+')"><tr><td id="image"><img src='+building.image[i]+'></td><td id="nameAndCost"><p>'+building.name[i]+'</p><p><span>'+building.cost[i]+'</span> cars</p></td><td id="amount"><span>'+building.count[i]+'</span></td></tr></table>';
          }
        }
      };

      window.onload = function(){
        load();
        display.updateCars();
        display.updateShop();
      };

        function save(){
          var gameSave = {
            cars: game.cars,
            totalCars: game.totalCars,
            totalClicks: game.totalClicks,
            clickValue: game.clickValue,
            version: game.version,
            buildingCount: building.count,
            buildingIncome: building.income,
            buildingCost: building.cost
          };
          localStorage.setItem("gameSave", JSON.stringify(gameSave));
        }

        function load(){
          var savedGame = JSON.parse(localStorage.getItem("gameSave"));
          if(localStorage.getItem("gameSave") !== null){
            if(typeof savedGame.cars !== "undefined") game.cars = savedGame.cars;
            if(typeof savedGame.totalCars !== "undefined") game.totalCars = savedGame.totalCars;
            if(typeof savedGame.totalClicks !== "undefined") game.totalClicks = savedGame.totalClicks;
            if(typeof savedGame.clickValue !== "undefined") game.clickValue = savedGame.clickValue;
            if(typeof savedGame.buildingCount !== "undefined"){
              for(i = 0; i < savedGame.buildingCount.length; i++){
                building.count[i] = savedGame.buildingCount[i];
              }
            }
            if(typeof savedGame.buildingIncome !== "undefined"){
              for(i = 0; i < savedGame.buildingIncome.length; i++){
                building.income[i] = savedGame.buildingIncome[i];
              }
            }
            if(typeof savedGame.buildingCost !== "undefined"){
              for(i = 0; i < savedGame.buildingCost.length; i++){
                building.cost[i] = savedGame.buildingCost[i];
              }
            }
          }
        }

      function reset(){
        if(confirm("Are you sure you want to reset the game?")){
          var gameSave = {};
          localStorage.setItem("gameSave", JSON.stringify(gameSave));
          location.reload();
        }
      }


      setInterval(function(){
        game.cars += game.getCarsPerSecond();
        game.totalCars += game.getCarsPerSecond();
        display.updateCars();
        document.getElementById("cars").innerHTML = cars;

        document.title = cars + " Cars | Car Clicker";
      }, 1000);

      setInterval(function(){
        save();
      }, 30000);

      document.addEventListener("keydown", function(event){
        if(event.ctrlKey && event.which == 83) {
          event.preventDefault();
          save();
        }
      }, false);

    </script>
  </body>
</html>
